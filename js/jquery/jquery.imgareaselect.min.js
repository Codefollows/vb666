/*
 imgAreaSelect jQuery plugin
 version 0.9.10

 Copyright (c) 2008-2013 Michal Wojciechowski (odyniec.net)

 Dual licensed under the MIT (MIT-LICENSE.txt)
 and GPL (GPL-LICENSE.txt) licenses.

 http://odyniec.net/projects/imgareaselect/

*/
(function(b){function C(){return b("<div/>")}var D=Math.abs,n=Math.max,p=Math.min,e=Math.round;b.imgAreaSelect=function(A,c){function P(a){return a+B.left-w.left}function Q(a){return a+B.top-w.top}function K(a){return a-B.left+w.left}function L(a){return a-B.top+w.top}function G(a){var c=a||V;a=a||W;return{x1:e(d.x1*c),y1:e(d.y1*a),x2:e(d.x2*c),y2:e(d.y2*a),width:e(d.x2*c)-e(d.x1*c),height:e(d.y2*a)-e(d.y1*a)}}function ka(a,c,b,g,f){var h=f||V;f=f||W;d={x1:e(a/h||0),y1:e(c/f||0),x2:e(b/
h||0),y2:e(g/f||0)};d.width=d.x2-d.x1;d.height=d.y2-d.y1}function M(){ba&&x.width()&&(B={left:e(x.offset().left),top:e(x.offset().top)},y=x.innerWidth(),v=x.innerHeight(),B.top+=x.outerHeight()-v>>1,B.left+=x.outerWidth()-y>>1,X=e(c.minWidth/V)||0,Y=e(c.minHeight/W)||0,la=e(p(c.maxWidth/V||16777216,y)),ma=e(p(c.maxHeight/W||16777216,v)),"1.3.2"!=b().jquery||"fixed"!=ca||na.getBoundingClientRect||(B.top+=n(document.body.scrollTop,na.scrollTop),B.left+=n(document.body.scrollLeft,na.scrollLeft)),w=/absolute|relative/.test(R.css("position"))?
{left:e(R.offset().left)-R.scrollLeft(),top:e(R.offset().top)-R.scrollTop()}:"fixed"==ca?{left:b(document).scrollLeft(),top:b(document).scrollTop()}:{left:0,top:0},q=P(0),r=Q(0),(d.x2>y||d.y2>v)&&da())}function ea(a){if(fa){l.css({left:P(d.x1),top:Q(d.y1)}).add(S).width(H=d.width).height(N=d.height);S.add(u).add(t).css({left:0,top:0});u.width(n(H-u.outerWidth()+u.innerWidth(),0)).height(n(N-u.outerHeight()+u.innerHeight(),0));b(m[0]).css({left:q,top:r,width:d.x1,height:v});b(m[1]).css({left:q+d.x1,
top:r,width:H,height:d.y1});b(m[2]).css({left:q+d.x2,top:r,width:y-d.x2,height:v});b(m[3]).css({left:q+d.x1,top:r+d.y2,width:H,height:v-d.y2});H-=t.outerWidth();N-=t.outerHeight();switch(t.length){case 8:b(t[4]).css({left:H>>1}),b(t[5]).css({left:H,top:N>>1}),b(t[6]).css({left:H>>1,top:N}),b(t[7]).css({top:N>>1});case 4:t.slice(1,3).css({left:H}),t.slice(2,4).css({top:N})}if(!1!==a&&(b.imgAreaSelect.onKeyPress!=wa&&b(document).off(b.imgAreaSelect.keyPress,b.imgAreaSelect.onKeyPress),c.keys))b(document)[b.imgAreaSelect.keyPress](b.imgAreaSelect.onKeyPress=
wa);T&&2==u.outerWidth()-u.innerWidth()&&(u.css("margin",0),setTimeout(function(){u.css("margin","auto")},0))}}function oa(a){M();ea(a);g=P(d.x1);f=Q(d.y1);h=P(d.x2);k=Q(d.y2)}function pa(a,b){c.fadeSpeed?a.fadeOut(c.fadeSpeed,b):a.hide()}function O(a){var b=K(a.pageX-w.left)-d.x1;a=L(a.pageY-w.top)-d.y1;qa||(M(),qa=!0,l.one("mouseout",function(){qa=!1}));z="";c.resizable&&(a<=c.resizeMargin?z="n":a>=d.height-c.resizeMargin&&(z="s"),b<=c.resizeMargin?z+="w":b>=d.width-c.resizeMargin&&(z+="e"));l.css("cursor",
z?z+"-resize":c.movable?"move":"");ha&&ha.toggle()}function xa(a){b("body").css("cursor","");(c.autoHide||0==d.width*d.height)&&pa(l.add(m),function(){b(this).hide()});b(document).off("mousemove",ra);l.mousemove(O);c.onSelectEnd(A,G())}function ya(a){if(1!=a.which)return!1;M();z?(b("body").css("cursor",z+"-resize"),g=P(d[/w/.test(z)?"x2":"x1"]),f=Q(d[/n/.test(z)?"y2":"y1"]),b(document).mousemove(ra).one("mouseup",xa),l.off("mousemove",O)):c.movable?(sa=q+d.x1-(a.pageX-w.left),ta=r+d.y1-(a.pageY-w.top),
l.off("mousemove",O),b(document).mousemove(za).one("mouseup",function(){c.onSelectEnd(A,G());b(document).off("mousemove",za);l.mousemove(O)})):x.mousedown(a);return!1}function Z(a){I&&(a?(h=n(q,p(q+y,g+D(k-f)*I*(h>g||-1))),k=e(n(r,p(r+v,f+D(h-g)/I*(k>f||-1)))),h=e(h)):(k=n(r,p(r+v,f+D(h-g)/I*(k>f||-1))),h=e(n(q,p(q+y,g+D(k-f)*I*(h>g||-1)))),k=e(k)))}function da(){g=p(g,q+y);f=p(f,r+v);D(h-g)<X&&(h=g-X*(h<g||-1),h<q?g=q+X:h>q+y&&(g=q+y-X));D(k-f)<Y&&(k=f-Y*(k<f||-1),k<r?f=r+Y:k>r+v&&(f=r+v-Y));h=n(q,
p(h,q+y));k=n(r,p(k,r+v));Z(D(h-g)<D(k-f)*I);D(h-g)>la&&(h=g-la*(h<g||-1),Z());D(k-f)>ma&&(k=f-ma*(k<f||-1),Z(!0));d={x1:K(p(g,h)),x2:K(n(g,h)),y1:L(p(f,k)),y2:L(n(f,k)),width:D(h-g),height:D(k-f)};ea();c.onSelectChange(A,G())}function ra(a){h=/w|e|^$/.test(z)||I?a.pageX-w.left:P(d.x2);k=/n|s|^$/.test(z)||I?a.pageY-w.top:Q(d.y2);da();return!1}function aa(a,e){h=(g=a)+d.width;k=(f=e)+d.height;b.extend(d,{x1:K(g),y1:L(f),x2:K(h),y2:L(k)});ea();c.onSelectChange(A,G())}function za(a){g=n(q,p(sa+(a.pageX-
w.left),q+y-d.width));f=n(r,p(ta+(a.pageY-w.top),r+v-d.height));aa(g,f);a.preventDefault();return!1}function ua(){b(document).off("mousemove",ua);M();h=g;k=f;da();z="";m.is(":visible")||l.add(m).hide().fadeIn(c.fadeSpeed||0);fa=!0;b(document).off("mouseup",ia).mousemove(ra).one("mouseup",xa);l.off("mousemove",O);c.onSelectStart(A,G())}function ia(){b(document).off("mousemove",ua).off("mouseup",ia);pa(l.add(m));ka(K(g),L(f),K(g),L(f));this instanceof b.imgAreaSelect||(c.onSelectChange(A,G()),c.onSelectEnd(A,
G()))}function Aa(a){if(1!=a.which||m.is(":animated"))return!1;M();sa=g=a.pageX-w.left;ta=f=a.pageY-w.top;b(document).mousemove(ua).mouseup(ia);return!1}function Ba(){oa(!1)}function Ca(){ba=!0;va(c=b.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},c));l.add(m).css({visibility:""});c.show&&(fa=!0,M(),ea(),l.add(m).hide().fadeIn(c.fadeSpeed||0));setTimeout(function(){c.onInit(A,
G())},0)}function ja(a,b){for(var d in b)void 0!==c[d]&&a.css(b[d],c[d])}function va(a){a.parent&&(R=b(a.parent)).append(l.add(m));b.extend(c,a);M();if(null!=a.handles){t.remove();t=b([]);for(U=a.handles?"corners"==a.handles?4:8:0;U--;)t=t.add(C());t.addClass(c.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:J+1||1});0<=!parseInt(t.css("width"))&&t.width(5).height(5);(F=c.borderWidth)&&t.css({borderWidth:F,borderStyle:"solid"});ja(t,{borderColor1:"border-color",borderColor2:"background-color",
borderOpacity:"opacity"})}V=c.imageWidth/y||1;W=c.imageHeight/v||1;null!=a.x1&&(ka(a.x1,a.y1,a.x2,a.y2),a.show=!a.hide);a.keys&&(c.keys=b.extend({shift:1,ctrl:"resize"},a.keys));m.addClass(c.classPrefix+"-outer");S.addClass(c.classPrefix+"-selection");for(U=0;4>U++;)b(u[U-1]).addClass(c.classPrefix+"-border"+U);ja(S,{selectionColor:"background-color",selectionOpacity:"opacity"});ja(u,{borderOpacity:"opacity",borderWidth:"border-width"});ja(m,{outerColor:"background-color",outerOpacity:"opacity"});
(F=c.borderColor1)&&b(u[0]).css({borderStyle:"solid",borderColor:F});(F=c.borderColor2)&&b(u[1]).css({borderStyle:"dashed",borderColor:F});l.append(S.add(u).add(ha)).append(t);T&&((F=(m.css("filter")||"").match(/opacity=(\d+)/))&&m.css("opacity",F[1]/100),(F=(u.css("filter")||"").match(/opacity=(\d+)/))&&u.css("opacity",F[1]/100));a.hide?pa(l.add(m)):a.show&&ba&&(fa=!0,l.add(m).fadeIn(c.fadeSpeed||0),oa());I=(Da=(c.aspectRatio||"").split(/:/))[0]/Da[1];x.add(m).off("mousedown",Aa);if(c.disable||!1===
c.enable)l.off("mousemove",O).off("mousedown",ya),b(window).off("resize",Ba);else{if(c.enable||!1===c.disable)(c.resizable||c.movable)&&l.mousemove(O).mousedown(ya),b(window).resize(Ba);c.persistent||x.add(m).mousedown(Aa)}c.enable=c.disable=void 0}var x=b(A),ba,l=C(),S=C(),u=C().add(C()).add(C()).add(C()),m=C().add(C()).add(C()).add(C()),t=b([]),ha,q,r,B={left:0,top:0},y,v,R,w={left:0,top:0},J=0,ca="absolute",sa,ta,V,W,z,X,Y,la,ma,I,fa,g,f,h,k,d={x1:0,y1:0,x2:0,y2:0,width:0,height:0},na=document.documentElement,
E=navigator.userAgent,Da,U,F,H,N,qa,wa=function(a){var b=c.keys,d=a.keyCode;var e=isNaN(b.alt)||!a.altKey&&!a.originalEvent.altKey?!isNaN(b.ctrl)&&a.ctrlKey?b.ctrl:!isNaN(b.shift)&&a.shiftKey?b.shift:isNaN(b.arrows)?10:b.arrows:b.alt;if("resize"==b.arrows||"resize"==b.shift&&a.shiftKey||"resize"==b.ctrl&&a.ctrlKey||"resize"==b.alt&&(a.altKey||a.originalEvent.altKey)){switch(d){case 37:e=-e;case 39:a=n(g,h);g=p(g,h);h=n(a+e,g);Z();break;case 38:e=-e;case 40:a=n(f,k);f=p(f,k);k=n(a+e,f);Z(!0);break;
default:return}da()}else switch(g=p(g,h),f=p(f,k),d){case 37:aa(n(g-e,q),f);break;case 38:aa(g,n(f-e,r));break;case 39:aa(g+p(e,y-K(h)),f);break;case 40:aa(g,f+p(e,v-L(k)));break;default:return}return!1};this.remove=function(){va({disable:!0});l.add(m).remove()};this.getOptions=function(){return c};this.setOptions=va;this.getSelection=G;this.setSelection=ka;this.cancelSelection=ia;this.update=oa;var T=(/msie ([\w.]+)/i.exec(E)||[])[1],Ea=/opera/i.test(E),Fa=/webkit/i.test(E)&&!/chrome/i.test(E);for(E=
x;E.length;)J=n(J,isNaN(E.css("z-index"))?J:E.css("z-index")),"fixed"==E.css("position")&&(ca="fixed"),E=E.parent(":not(body)");J=c.zIndex||J;T&&x.attr("unselectable","on");b.imgAreaSelect.keyPress=T||Fa?"keydown":"keypress";Ea&&(ha=C().css({width:"100%",height:"100%",position:"absolute",zIndex:J+2||2}));l.add(m).css({visibility:"hidden",position:ca,overflow:"hidden",zIndex:J||"0"});l.css({zIndex:J+2||2});S.add(u).css({position:"absolute",fontSize:0});A.complete||"complete"==A.readyState||!x.is("img")?
Ca():x.one("load",Ca);!ba&&T&&7<=T&&(A.src=A.src)};b.fn.imgAreaSelect=function(e){e=e||{};this.each(function(){b(this).data("imgAreaSelect")?e.remove?(b(this).data("imgAreaSelect").remove(),b(this).removeData("imgAreaSelect")):b(this).data("imgAreaSelect").setOptions(e):e.remove||(void 0===e.enable&&void 0===e.disable&&(e.enable=!0),b(this).data("imgAreaSelect",new b.imgAreaSelect(this,e)))});return e.instance?b(this).data("imgAreaSelect"):this}})(jQuery);
