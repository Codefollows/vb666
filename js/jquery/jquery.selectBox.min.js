/*
 jQuery selectBox - A cosmetic, styleable replacement for SELECT elements

  Copyright 2012 Cory LaViska for A Beautiful Site, LLC.

  https://github.com/claviska/jquery-selectBox

  Licensed under both the MIT license and the GNU GPLv2 (same as jQuery: http://jquery.org/license)


  Note: Modified for vBulletin. Grep for 'vBulletin' to see the changes.
*/
jQuery&&function(c){c.extend(c.fn,{selectBox:function(x,k){var y,p="",z=navigator.platform.match(/mac/i),E=function(a,b){if(navigator.userAgent.match(/iPad|iPhone|Android|IEMobile|BlackBerry/i)||"select"!==a.tagName.toLowerCase())return!1;a=c(a);if(a.data("selectBox-control")||a.is(":hidden")&&(!b||!b.allowHidden))return!1;var e=c('<a class="selectBox" />'),d=a.attr("multiple")||1<parseInt(a.attr("size"));b=b||{};e.addClass(a.attr("class")).attr("title",a.attr("title")||"").attr("tabindex",
parseInt(a.attr("tabindex"))).css("display","inline-block").on("focus.selectBox",function(){this!==document.activeElement&&document.body!==document.activeElement&&c(document.activeElement).blur();e.hasClass("selectBox-active")||(e.addClass("selectBox-active"),a.trigger("focus"))}).on("blur.selectBox",function(){e.hasClass("selectBox-active")&&(e.removeClass("selectBox-active"),a.trigger("blur"))});if(!c(window).data("selectBox-bindings"))c(window).data("selectBox-bindings",!0).on("scroll.selectBox",
l).on("resize.selectBox",l);a.attr("disabled")&&e.addClass("selectBox-disabled");a.on("click.selectBox",function(a){e.focus();a.preventDefault()});if(d){var f=t(a,"inline");e.append(f).data("selectBox-options",f).addClass("selectBox-inline selectBox-menuShowing").on("keydown.selectBox",function(b){A(a,b)}).on("keypress.selectBox",function(b){B(a,b)}).on("mousedown.selectBox",function(a){c(a.target).is("A.selectBox-inline")&&a.preventDefault();e.hasClass("selectBox-focus")||e.focus()}).insertAfter(a);
e.width(a.css("fontSize",e.css("fontSize")).outerWidth());if(!a[0].style.height){d=a.attr("size")?parseInt(a.attr("size")):5;var h=e.clone().removeAttr("id").css({position:"absolute",top:"-9999em"}).show().appendTo("body");h.find(".selectBox-options").html("<li><a> </a></li>");var g=parseInt(h.find(".selectBox-options A:first").html("&nbsp;").outerHeight());h.remove();e.height(g*d)}}else d=c('<span class="selectBox-label" />'),h=c('<span class="selectBox-arrow" />'),d.attr("class",C(a)).text(D(a)),
f=t(a,"dropdown"),f.appendTo("BODY"),e.data("selectBox-options",f).addClass("selectBox-dropdown").append(d).append(h).on("mousedown.selectBox",function(b){e.hasClass("selectBox-menuShowing")?l():(b.stopPropagation(),f.data("selectBox-down-at-x",b.screenX).data("selectBox-down-at-y",b.screenY),m(a))}).on("keydown.selectBox",function(b){A(a,b)}).on("keypress.selectBox",function(b){B(a,b)}).on("open.selectBox",function(b,c){c&&!0===c._selectBox||m(a)}).on("close.selectBox",function(a,b){b&&!0===b._selectBox||
l()}).insertAfter(a),g=a.addClass("h-pre-selectbox").outerWidth(),e.width(g),h=e.width()-h.outerWidth()-parseInt(d.css("paddingLeft"))-parseInt(d.css("paddingRight")),d.width(h);u(e);a.addClass("selectBox").data("selectBox-control",e).data("selectBox-settings",b).hide()},t=function(a,b){var e=function(a,b){a.children("OPTION, OPTGROUP").each(function(){if(c(this).is("OPTION"))if(0<c(this).length){var a=c(this),d=b,f=c("<li />"),h=c("<a />");f.addClass(a.attr("class"));f.data(a.data());h.attr("rel",
a.val()).text(a.text());f.append(h);a.attr("disabled")&&f.addClass("selectBox-disabled");a.prop("selected")&&f.addClass("selectBox-selected");d.append(f)}else b.append("<li> </li>");else a=c('<li class="selectBox-optgroup" />'),a.text(c(this).attr("label")),b.append(a),b=e(c(this),b)});return b};switch(b){case "inline":var d=c('<ul class="selectBox-options" />');d=e(a,d);d.find("A").on("mouseover.selectBox",function(b){n(a,c(this).parent())}).on("mouseout.selectBox",function(b){v(a,c(this).parent())}).on("mousedown.selectBox",
function(b){b.preventDefault();a.selectBox("control").hasClass("selectBox-active")||a.selectBox("control").focus()}).on("mouseup.selectBox",function(b){l();q(a,c(this).parent(),b)});u(d);return d;case "dropdown":d=c('<ul class="selectBox-dropdown-menu selectBox-options" />');d=e(a,d);d.data("selectBox-select",a).css("display","none").appendTo("BODY").find("A").on("mousedown.selectBox",function(a){a.preventDefault();a.screenX===d.data("selectBox-down-at-x")&&a.screenY===d.data("selectBox-down-at-y")&&
(d.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),l())}).on("mouseup.selectBox",function(b){if(b.screenX!==d.data("selectBox-down-at-x")||b.screenY!==d.data("selectBox-down-at-y"))d.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),q(a,c(this).parent()),l()}).on("mouseover.selectBox",function(b){n(a,c(this).parent())}).on("mouseout.selectBox",function(b){v(a,c(this).parent())});b=a.attr("class")||"";if(""!==b){b=b.split(" ");for(var f in b)d.addClass(b[f]+"-selectBox-dropdown-menu")}u(d);
return d}},C=function(a){return("selectBox-label "+(c(a).find("OPTION:selected").attr("class")||"")).replace(/\s+$/,"")},D=function(a){return c(a).find("OPTION:selected").text()||String.fromCharCode(160)},w=function(a){a=c(a);var b=a.data("selectBox-control");b&&b.find(".selectBox-label").attr("class",C(a)).text(D(a))},m=function(a){a=c(a);var b=a.data("selectBox-control")||c(),e=a.data("selectBox-settings")||{},d=b.data("selectBox-options")||c();if(b.hasClass("selectBox-disabled"))return!1;l();var f=
parseInt(b.css("borderBottomWidth"))||0;d.width(b.innerWidth()).css({top:b.offset().top+b.outerHeight()-f,left:b.offset().left});if(a.triggerHandler("beforeopen"))return!1;f=function(){a.triggerHandler("open",{_selectBox:!0});var e=c(window).scrollTop(),f=e+c(window).height(),k=d.offset().top,l=k+d.outerHeight();0<=k-e&&0<=f-l||d.css("top",parseFloat(d.css("top"))-(b.outerHeight()+d.outerHeight()))};switch(e.menuTransition){case "fade":d.fadeIn(e.menuSpeed,f);break;case "slide":d.slideDown(e.menuSpeed,
f);break;default:d.show(e.menuSpeed,f)}e.menuSpeed||f();e=d.find(".selectBox-selected:first");r(a,e,!0);n(a,e);b.addClass("selectBox-menuShowing");c(document).on("mousedown.selectBox",function(a){c(a.target).parents().addBack().hasClass("selectBox-options")||l()})},l=function(){0!==c(".selectBox-dropdown-menu:visible").length&&(c(document).off("mousedown.selectBox"),c(".selectBox-dropdown-menu").each(function(){var a=c(this),b=a.data("selectBox-select")||c(),e=b.data("selectBox-control")||c(),d=b.data("selectBox-settings")||
{};if(b.triggerHandler("beforeclose"))return!1;var f=function(){b.triggerHandler("close",{_selectBox:!0})};switch(d.menuTransition){case "fade":a.fadeOut(d.menuSpeed,f);break;case "slide":a.slideUp(d.menuSpeed,f);break;default:a.hide(d.menuSpeed,f)}d.menuSpeed||f();e.removeClass("selectBox-menuShowing")}))},q=function(a,b,e){a=c(a);b=c(b);var d=a.data("selectBox-control")||c();a.data("selectBox-settings");if(d.hasClass("selectBox-disabled")||0===b.length||b.hasClass("selectBox-disabled"))return!1;
a.attr("multiple")?e.shiftKey&&d.data("selectBox-last-selected")?(b.toggleClass("selectBox-selected"),e=b.index()>d.data("selectBox-last-selected").index()?b.siblings().slice(d.data("selectBox-last-selected").index(),b.index()):b.siblings().slice(b.index(),d.data("selectBox-last-selected").index()),e=e.not(".selectBox-optgroup, .selectBox-disabled"),b.hasClass("selectBox-selected")?e.addClass("selectBox-selected"):e.removeClass("selectBox-selected")):z&&e.metaKey||!z&&e.ctrlKey?b.toggleClass("selectBox-selected"):
(b.siblings().removeClass("selectBox-selected"),b.addClass("selectBox-selected")):(b.siblings().removeClass("selectBox-selected"),b.addClass("selectBox-selected"));d.hasClass("selectBox-dropdown")&&d.find(".selectBox-label").text(b.text());var f=0,h=[];a.attr("multiple")?d.find(".selectBox-selected A").each(function(){h[f++]=c(this).attr("rel")}):h=b.find("A").attr("rel");d.data("selectBox-last-selected",b);a.val()!==h&&(a.val(h),w(a),a.trigger("change"));return!0},n=function(a,b){a=c(a);b=c(b);((a.data("selectBox-control")||
c()).data("selectBox-options")||c()).find(".selectBox-hover").removeClass("selectBox-hover");b.addClass("selectBox-hover")},v=function(a,b){a=c(a);c(b);((a.data("selectBox-control")||c()).data("selectBox-options")||c()).find(".selectBox-hover").removeClass("selectBox-hover")},r=function(a,b,e){if(b&&0!==b.length){a=c(a);a=a.data("selectBox-control")||c();var d=a.data("selectBox-options")||c();a=a.hasClass("selectBox-dropdown")?d:d.parent();d=parseInt(b.offset().top-a.position().top);var f=parseInt(d+
b.outerHeight());e?a.scrollTop(b.offset().top-a.offset().top+a.scrollTop()-a.height()/2):(0>d&&a.scrollTop(b.offset().top-a.offset().top+a.scrollTop()),f>a.height()&&a.scrollTop(b.offset().top+b.outerHeight()-a.offset().top+a.scrollTop()-a.height()))}},A=function(a,b){a=c(a);var e=a.data("selectBox-control")||c(),d=e.data("selectBox-options")||c(),f=a.data("selectBox-settings")||{},h;if(!e.hasClass("selectBox-disabled"))switch(b.keyCode){case 8:b.preventDefault();p="";break;case 9:case 27:l();v(a);
break;case 13:e.hasClass("selectBox-menuShowing")?(q(a,d.find("LI.selectBox-hover:first"),b),e.hasClass("selectBox-dropdown")&&l()):m(a);break;case 38:case 37:b.preventDefault();if(e.hasClass("selectBox-menuShowing")){var g=d.find(".selectBox-hover").prev("LI");e=d.find("LI:not(.selectBox-optgroup)").length;for(h=0;(0===g.length||g.hasClass("selectBox-disabled")||g.hasClass("selectBox-optgroup"))&&!(g=g.prev("LI"),0===g.length&&(g=f.loopOptions?d.find("LI:last"):d.find("LI:first")),++h>=e););n(a,
g);q(a,g,b);r(a,g)}else m(a);break;case 40:case 39:if(b.preventDefault(),e.hasClass("selectBox-menuShowing")){g=d.find(".selectBox-hover").next("LI");e=d.find("LI:not(.selectBox-optgroup)").length;for(h=0;(0===g.length||g.hasClass("selectBox-disabled")||g.hasClass("selectBox-optgroup"))&&!(g=g.next("LI"),0===g.length&&(g=f.loopOptions?d.find("LI:first"):d.find("LI:last")),++h>=e););n(a,g);q(a,g,b);r(a,g)}else m(a)}},B=function(a,b){a=c(a);var e=a.data("selectBox-control")||c(),d=e.data("selectBox-options")||
c();if(!e.hasClass("selectBox-disabled"))switch(b.keyCode){case 9:case 27:case 13:case 38:case 37:case 40:case 39:break;default:e.hasClass("selectBox-menuShowing")||m(a),b.preventDefault(),clearTimeout(y),p+=String.fromCharCode(b.charCode||b.keyCode),d.find("A").each(function(){if(c(this).text().substr(0,p.length).toLowerCase()===p.toLowerCase())return n(a,c(this).parent()),r(a,c(this).parent()),!1}),y=setTimeout(function(){p=""},1E3)}},F=function(a,b){a=c(a);a.val(b);b=a.val();null!==b||a.attr("multiple")||
(a[0].selectedIndex=0,b=a.val());var e=a.data("selectBox-control");if(e){var d=a.data("selectBox-settings")||{};e=e.data("selectBox-options")||c();w(a);e.find(".selectBox-selected").removeClass("selectBox-selected");e.find("A").each(function(){if("object"===typeof b)for(var a=0;a<b.length;a++)c(this).attr("rel")==b[a]&&c(this).parent().addClass("selectBox-selected");else c(this).attr("rel")==b&&c(this).parent().addClass("selectBox-selected")});d.change&&d.change.call(a)}},u=function(a){c(a).css("MozUserSelect",
"none").on("selectstart",function(a){a.preventDefault()})};switch(x){case "control":return c(this).data("selectBox-control");case "settings":if(!k)return c(this).data("selectBox-settings");c(this).each(function(){c(this).data("selectBox-settings",c.extend(!0,c(this).data("selectBox-settings"),k))});break;case "options":if(void 0===k)return c(this).data("selectBox-control").data("selectBox-options");c(this).each(function(){var a=c(this);var b=a.data("selectBox-control")||c();a.data("selectBox-settings");
switch(typeof k){case "string":a.html(k);break;case "object":for(f in a.html(""),k)if(null!==k[f])if("object"===typeof k[f]){var e=c('<optgroup label="'+f+'" />');for(d in k[f])e.append('<option value="'+d+'">'+k[f][d]+"</option>");a.append(e)}else e=c('<option value="'+f+'">'+k[f]+"</option>"),a.append(e)}if(b){b.data("selectBox-options").remove();var d=b.hasClass("selectBox-dropdown")?"dropdown":"inline";var f=t(a,d);b.data("selectBox-options",f);switch(d){case "inline":b.append(f);break;case "dropdown":w(a),
c("BODY").append(f)}}});break;case "value":if(void 0===k)return c(this).val();c(this).each(function(){F(this,k)});break;case "refresh":c(this).each(function(){var a=c(this);a.selectBox("options",a.html())});break;case "enable":c(this).each(function(){var a=c(this);a.attr("disabled",!1);(a=a.data("selectBox-control"))&&a.removeClass("selectBox-disabled")});break;case "disable":c(this).each(function(){var a=c(this);a.attr("disabled",!0);(a=a.data("selectBox-control"))&&a.addClass("selectBox-disabled")});
break;case "destroy":c(this).each(function(){var a=c(this);var b=a.data("selectBox-control");b&&((b.data("selectBox-options")||c()).remove(),b.remove(),a.removeClass("selectBox").removeData("selectBox-control").data("selectBox-control",null).removeData("selectBox-settings").data("selectBox-settings",null).show())});break;default:c(this).each(function(){E(this,x)})}return c(this)}})}(jQuery);
