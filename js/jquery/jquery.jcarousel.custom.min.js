/*
 jCarousel - Riding carousels with jQuery
   http://sorgalla.com/jcarousel/

 Copyright (c) 2006 Jan Sorgalla (http://sorgalla.com)
 Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.

 Built on top of the jQuery library
   http://jquery.com

 Inspired by the "Carousel Component" by Bill Scott
   http://billwscott.com/carousel/

   Modified for vBulletin:
   - added destroy method
   - changed reset method by adding a flag to call setup method
   - added check for undefined instance in the main jcarousel function
*/
(function(g){var u={vertical:!1,rtl:!1,start:1,offset:1,size:null,scroll:3,visible:null,animation:"normal",easing:"swing",auto:0,wrap:null,initCallback:null,setupCallback:null,reloadCallback:null,itemLoadCallback:null,itemFirstInCallback:null,itemFirstOutCallback:null,itemLastInCallback:null,itemLastOutCallback:null,itemVisibleInCallback:null,itemVisibleOutCallback:null,animationStepCallback:null,buttonNextHTML:"<div></div>",buttonPrevHTML:"<div></div>",buttonNextEvent:"click",buttonPrevEvent:"click",
buttonNextCallback:null,buttonPrevCallback:null,itemFallbackDimension:null},q=!1;g(window).on("load.jcarousel",function(){q=!0});g.jcarousel=function(a,b){this.options=g.extend({},u,b||{});this.autoStopped=this.locked=!1;this.buttonPrevState=this.buttonNextState=this.buttonPrev=this.buttonNext=this.list=this.clip=this.container=null;b&&void 0!==b.rtl||(this.options.rtl="rtl"==(g(a).attr("dir")||g("html").attr("dir")||"").toLowerCase());this.wh=this.options.vertical?"height":"width";this.lt=this.options.vertical?
"top":this.options.rtl?"right":"left";for(var c="",e=a.className.split(" "),n=0;n<e.length;n++)if(-1!=e[n].indexOf("jcarousel-skin")){g(a).removeClass(e[n]);c=e[n];break}"UL"==a.nodeName.toUpperCase()||"OL"==a.nodeName.toUpperCase()?(this.list=g(a),this.clip=this.list.parents(".jcarousel-clip"),this.container=this.list.parents(".jcarousel-container")):(this.container=g(a),this.list=this.container.find("ul,ol").eq(0),this.clip=this.container.find(".jcarousel-clip"));0===this.clip.length&&(this.clip=
this.list.wrap("<div></div>").parent());0===this.container.length&&(this.container=this.clip.wrap("<div></div>").parent());""!==c&&-1==this.container.parent()[0].className.indexOf("jcarousel-skin")&&this.container.wrap('<div class=" '+c+'"></div>');this.buttonPrev=g(".jcarousel-prev",this.container);0===this.buttonPrev.length&&null!==this.options.buttonPrevHTML&&(this.buttonPrev=g(this.options.buttonPrevHTML).appendTo(this.container));this.buttonPrev.addClass(this.className("jcarousel-prev"));this.buttonNext=
g(".jcarousel-next",this.container);0===this.buttonNext.length&&null!==this.options.buttonNextHTML&&(this.buttonNext=g(this.options.buttonNextHTML).appendTo(this.container));this.buttonNext.addClass(this.className("jcarousel-next"));this.clip.addClass(this.className("jcarousel-clip")).css({position:"relative"});this.list.addClass(this.className("jcarousel-list")).css({overflow:"hidden",position:"relative",top:0,margin:0,padding:0}).css(this.options.rtl?"right":"left",0);this.container.addClass(this.className("jcarousel-container")).css({position:"relative"});
!this.options.vertical&&this.options.rtl&&this.container.addClass("jcarousel-direction-rtl").attr("dir","rtl");var l=null!==this.options.visible?Math.ceil(this.clipping()/this.options.visible):null;a=this.list.children("li");var d=this;if(0<a.length){var h=0,k=this.options.offset;a.each(function(){d.format(this,k++);h+=d.dimension(this,l)});this.list.css(this.wh,h+100+"px");b&&void 0!==b.size||(this.options.size=a.length)}this.container.css("display","block");this.buttonNext.css("display","block");
this.buttonPrev.css("display","block");this.funcNext=function(){d.next();return!1};this.funcPrev=function(){d.prev();return!1};this.funcResize=function(){d.resizeTimer&&clearTimeout(d.resizeTimer);d.resizeTimer=setTimeout(function(){d.reload()},100)};null!==this.options.initCallback&&this.options.initCallback(this,"init");!q&&f.isSafari()?(this.buttons(!1,!1),g(window).on("load.jcarousel",function(){d.setup()})):this.setup()};var f=g.jcarousel;f.fn=f.prototype={jcarousel:"0.2.10"};f.fn.extend=f.extend=
g.extend;f.fn.extend({setup:function(){this.prevLast=this.prevFirst=this.last=this.first=null;this.animating=!1;this.tail=this.resizeTimer=this.timer=null;this.inTail=!1;if(!this.locked){this.list.css(this.lt,this.pos(this.options.offset)+"px");var a=this.pos(this.options.start,!0);this.prevFirst=this.prevLast=null;this.animate(a,!1);g(window).off("resize.jcarousel",this.funcResize).on("resize.jcarousel",this.funcResize);null!==this.options.setupCallback&&this.options.setupCallback(this)}},reset:function(a){this.list.empty();
this.list.css(this.lt,"0px");this.list.css(this.wh,"10px");null!==this.options.initCallback&&this.options.initCallback(this,"reset");a&&this.setup()},reload:function(){null!==this.tail&&this.inTail&&this.list.css(this.lt,f.intval(this.list.css(this.lt))+this.tail);this.tail=null;this.inTail=!1;null!==this.options.reloadCallback&&this.options.reloadCallback(this);if(null!==this.options.visible){var a=this,b=Math.ceil(this.clipping()/this.options.visible),c=0,e=0;this.list.children("li").each(function(f){c+=
a.dimension(this,b);f+1<a.first&&(e=c)});this.list.css(this.wh,c+"px");this.list.css(this.lt,-e+"px")}this.scroll(this.first,!1)},canmove(){return!(this.locked||this.animating)},lock:function(){this.locked=!0;this.buttons()},unlock:function(){this.locked=!1;this.buttons()},size:function(a){void 0!==a&&(this.options.size=a,this.locked||this.buttons());return this.options.size},has:function(a,b){void 0!==b&&b||(b=a);null!==this.options.size&&b>this.options.size&&(b=this.options.size);for(;a<=b;a++){var c=
this.get(a);if(!c.length||c.hasClass("jcarousel-item-placeholder"))return!1}return!0},get:function(a){return g(">.jcarousel-item-"+a,this.list)},add:function(a,b){var c=this.get(a),e=0,n=g(b);if(0===c.length){var l=f.intval(a);for(c=this.create(a);;){var d=this.get(--l);if(0>=l||d.length){0>=l?this.list.prepend(c):d.after(c);break}}}else e=this.dimension(c);"LI"==n.get(0).nodeName.toUpperCase()?(c.replaceWith(n),c=n):c.empty().append(b);this.format(c.removeClass(this.className("jcarousel-item-placeholder")),
a);b=null!==this.options.visible?Math.ceil(this.clipping()/this.options.visible):null;e=this.dimension(c,b)-e;0<a&&a<this.first&&this.list.css(this.lt,f.intval(this.list.css(this.lt))-e+"px");this.list.css(this.wh,f.intval(this.list.css(this.wh))+e+"px");return c},remove:function(a){var b=this.get(a);if(b.length&&!(a>=this.first&&a<=this.last)){var c=this.dimension(b);a<this.first&&this.list.css(this.lt,f.intval(this.list.css(this.lt))+c+"px");b.remove();this.list.css(this.wh,f.intval(this.list.css(this.wh))-
c+"px")}},next:function(){null===this.tail||this.inTail?this.scroll("both"!=this.options.wrap&&"last"!=this.options.wrap||null===this.options.size||this.last!=this.options.size?this.first+this.options.scroll:1):this.scrollTail(!1)},prev:function(){null!==this.tail&&this.inTail?this.scrollTail(!0):this.scroll("both"!=this.options.wrap&&"first"!=this.options.wrap||null===this.options.size||1!=this.first?this.first-this.options.scroll:this.options.size)},scrollTail:function(a){if(!this.locked&&!this.animating&&
this.tail){this.pauseAuto();var b=f.intval(this.list.css(this.lt));b=a?b+this.tail:b-this.tail;this.inTail=!a;this.prevFirst=this.first;this.prevLast=this.last;this.animate(b)}},scroll:function(a,b){this.locked||this.animating||(this.pauseAuto(),this.animate(this.pos(a),b))},pos:function(a,b){var c=f.intval(this.list[0].style[this.lt]);if(this.locked||this.animating)return c;"circular"!=this.options.wrap&&(a=1>a?1:this.options.size&&a>this.options.size?this.options.size:a);for(var e=this.first>a,
g="circular"!=this.options.wrap&&1>=this.first?1:this.first,l=e?this.get(g):this.get(this.last),d=e?g:g-1,h,k=0,m,p;e?--d>=a:++d<a;)h=this.get(d),m=!h.length,0===h.length&&(h=this.create(d).addClass(this.className("jcarousel-item-placeholder")),l[e?"before":"after"](h),null!==this.first&&"circular"==this.options.wrap&&null!==this.options.size&&(0>=d||d>this.options.size)&&(l=this.get(this.index(d)),l.length&&(h=this.add(d,l.clone(!0))))),l=h,p=this.dimension(h),m&&(k+=p),null!==this.first&&("circular"==
this.options.wrap||1<=d&&(null===this.options.size||d<=this.options.size))&&(c=e?c+p:c-p);g=this.clipping();var q=[],t=0,r=0;l=this.get(a-1);for(d=a;++t;){h=this.get(d);m=!h.length;if(0===h.length){h=this.create(d).addClass(this.className("jcarousel-item-placeholder"));if(0===l.length)this.list.prepend(h);else l[e?"before":"after"](h);null!==this.first&&"circular"==this.options.wrap&&null!==this.options.size&&(0>=d||d>this.options.size)&&(l=this.get(this.index(d)),l.length&&(h=this.add(d,l.clone(!0))))}l=
h;p=this.dimension(h);if(0===p)throw Error("jCarousel: No width/height set for items. This will cause an infinite loop. Aborting...");"circular"!=this.options.wrap&&null!==this.options.size&&d>this.options.size?q.push(h):m&&(k+=p);r+=p;if(r>=g)break;d++}for(h=0;h<q.length;h++)q[h].remove();0<k&&(this.list.css(this.wh,this.dimension(this.list)+k+"px"),e&&(c-=k,this.list.css(this.lt,f.intval(this.list.css(this.lt))-k+"px")));k=a+t-1;"circular"!=this.options.wrap&&this.options.size&&k>this.options.size&&
(k=this.options.size);if(d>k)for(t=0,d=k,r=0;++t;){h=this.get(d--);if(!h.length)break;r+=this.dimension(h);if(r>=g)break}d=k-t+1;"circular"!=this.options.wrap&&1>d&&(d=1);this.inTail&&e&&(c+=this.tail,this.inTail=!1);this.tail=null;"circular"!=this.options.wrap&&k==this.options.size&&1<=k-t+1&&(e=f.intval(this.get(k).css(this.options.vertical?"marginBottom":"marginRight")),r-e>g&&(this.tail=r-g-e));b&&a===this.options.size&&this.tail&&(c-=this.tail,this.inTail=!0);for(;a-- >d;)c+=this.dimension(this.get(a));
this.prevFirst=this.first;this.prevLast=this.last;this.first=d;this.last=k;return c},animate:function(a,b){if(!this.locked&&!this.animating){this.animating=!0;var c=this,e=function(){c.animating=!1;0===a&&c.list.css(c.lt,0);!c.autoStopped&&("circular"==c.options.wrap||"both"==c.options.wrap||"last"==c.options.wrap||null===c.options.size||c.last<c.options.size||c.last==c.options.size&&null!==c.tail&&!c.inTail)&&c.startAuto();c.buttons();c.notify("onAfterAnimation");if("circular"==c.options.wrap&&null!==
c.options.size)for(var b=c.prevFirst;b<=c.prevLast;b++)null===b||b>=c.first&&b<=c.last||!(1>b||b>c.options.size)||c.remove(b)};this.notify("onBeforeAnimation");this.options.animation&&!1!==b?(b=this.options.vertical?{top:a}:this.options.rtl?{right:a}:{left:a},e={duration:this.options.animation,easing:this.options.easing,complete:e},g.isFunction(this.options.animationStepCallback)&&(e.step=this.options.animationStepCallback),this.list.animate(b,e)):(this.list.css(this.lt,a+"px"),e())}},startAuto:function(a){void 0!==
a&&(this.options.auto=a);if(0===this.options.auto)return this.stopAuto();if(null===this.timer){this.autoStopped=!1;var b=this;this.timer=window.setTimeout(function(){b.next()},1E3*this.options.auto)}},stopAuto:function(){this.pauseAuto();this.autoStopped=!0},pauseAuto:function(){null!==this.timer&&(window.clearTimeout(this.timer),this.timer=null)},buttons:function(a,b){null==a&&(a=!this.locked&&0!==this.options.size&&(this.options.wrap&&"first"!=this.options.wrap||null===this.options.size||this.last<
this.options.size),!(this.locked||this.options.wrap&&"first"!=this.options.wrap)&&null!==this.options.size&&this.last>=this.options.size&&(a=null!==this.tail&&!this.inTail));null==b&&(b=!this.locked&&0!==this.options.size&&(this.options.wrap&&"last"!=this.options.wrap||1<this.first),this.locked||this.options.wrap&&"last"!=this.options.wrap||null===this.options.size||1!=this.first||(b=null!==this.tail&&this.inTail));var c=this;if(0<this.buttonNext.length){this.buttonNext.off(this.options.buttonNextEvent+
".jcarousel",this.funcNext);if(a)this.buttonNext.on(this.options.buttonNextEvent+".jcarousel",this.funcNext);this.buttonNext[a?"removeClass":"addClass"](this.className("jcarousel-next-disabled")).attr("disabled",a?!1:!0);null!==this.options.buttonNextCallback&&this.buttonNext.data("jcarouselstate")!=a&&this.buttonNext.each(function(){c.options.buttonNextCallback(c,this,a)}).data("jcarouselstate",a)}else null!==this.options.buttonNextCallback&&this.buttonNextState!=a&&this.options.buttonNextCallback(c,
null,a);if(0<this.buttonPrev.length){this.buttonPrev.off(this.options.buttonPrevEvent+".jcarousel",this.funcPrev);if(b)this.buttonPrev.on(this.options.buttonPrevEvent+".jcarousel",this.funcPrev);this.buttonPrev[b?"removeClass":"addClass"](this.className("jcarousel-prev-disabled")).attr("disabled",b?!1:!0);null!==this.options.buttonPrevCallback&&this.buttonPrev.data("jcarouselstate")!=b&&this.buttonPrev.each(function(){c.options.buttonPrevCallback(c,this,b)}).data("jcarouselstate",b)}else null!==this.options.buttonPrevCallback&&
this.buttonPrevState!=b&&this.options.buttonPrevCallback(c,null,b);this.buttonNextState=a;this.buttonPrevState=b},notify:function(a){var b=null===this.prevFirst?"init":this.prevFirst<this.first?"next":"prev";this.callback("itemLoadCallback",a,b);this.prevFirst!==this.first&&(this.callback("itemFirstInCallback",a,b,this.first),this.callback("itemFirstOutCallback",a,b,this.prevFirst));this.prevLast!==this.last&&(this.callback("itemLastInCallback",a,b,this.last),this.callback("itemLastOutCallback",a,
b,this.prevLast));this.callback("itemVisibleInCallback",a,b,this.first,this.last,this.prevFirst,this.prevLast);this.callback("itemVisibleOutCallback",a,b,this.prevFirst,this.prevLast,this.first,this.last)},callback:function(a,b,c,e,f,l,d){if(null!=this.options[a]&&("object"==typeof this.options[a]||"onAfterAnimation"==b)){var h="object"==typeof this.options[a]?this.options[a][b]:this.options[a];if(g.isFunction(h)){var k=this;if(void 0===e)h(k,c,b);else if(void 0===f)this.get(e).each(function(){h(k,
this,e,c,b)});else{a=function(a){k.get(a).each(function(){h(k,this,a,c,b)})};for(var m=e;m<=f;m++)null===m||m>=l&&m<=d||a(m)}}}},create:function(a){return this.format("<li></li>",a)},destroy:function(){this.reset();g(window).off(".jcarousel");this.list.removeData("jcarousel");this.container.removeData("jcarousel");this.buttonNext.removeData("jcarouselstate").remove();this.buttonPrev.removeData("jcarouselstate").remove();return this},format:function(a,b){a=g(a);for(var c=a.get(0).className.split(" "),
e=0;e<c.length;e++)-1!=c[e].indexOf("jcarousel-")&&a.removeClass(c[e]);a.addClass(this.className("jcarousel-item")).addClass(this.className("jcarousel-item-"+b)).css({"float":this.options.rtl?"right":"left","list-style":"none"}).attr("jcarouselindex",b);return a},className:function(a){return a+" "+a+(this.options.vertical?"-vertical":"-horizontal")},dimension:function(a,b){a=g(a);if(null==b)return this.options.vertical?a.innerHeight()+f.intval(a.css("margin-top"))+f.intval(a.css("margin-bottom"))+
f.intval(a.css("border-top-width"))+f.intval(a.css("border-bottom-width"))||f.intval(this.options.itemFallbackDimension):a.innerWidth()+f.intval(a.css("margin-left"))+f.intval(a.css("margin-right"))+f.intval(a.css("border-left-width"))+f.intval(a.css("border-right-width"))||f.intval(this.options.itemFallbackDimension);b=this.options.vertical?b-f.intval(a.css("marginTop"))-f.intval(a.css("marginBottom")):b-f.intval(a.css("marginLeft"))-f.intval(a.css("marginRight"));g(a).css(this.wh,b+"px");return this.dimension(a)},
clipping:function(){return this.options.vertical?this.clip[0].offsetHeight-f.intval(this.clip.css("borderTopWidth"))-f.intval(this.clip.css("borderBottomWidth")):this.clip[0].offsetWidth-f.intval(this.clip.css("borderLeftWidth"))-f.intval(this.clip.css("borderRightWidth"))},index:function(a,b){null==b&&(b=this.options.size);return Math.round(((a-1)/b-Math.floor((a-1)/b))*b)+1}});f.extend({defaults:function(a){return g.extend(u,a||{})},intval:function(a){a=parseInt(a,10);return isNaN(a)?0:a},windowLoaded:function(){q=
!0},isSafari:function(){var a=navigator.userAgent.toLowerCase();return"webkit"===((/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||[])[1]||"")}});g.fn.jcarousel=function(a){if("string"==typeof a){var b=g(this).data("jcarousel"),c=Array.prototype.slice.call(arguments,1);return"undefined"!=typeof b?b[a].apply(b,c):this}return this.each(function(){var b=g(this).data("jcarousel");b?(a&&g.extend(b.options,a),b.reload()):g(this).data("jcarousel",new f(this,a))})}})(jQuery);
